Decision Trees with Package `rpart`
========================================================

Package `rpart` [Therneau et al., 2010] is used to build a decision tree on the bodyfat data . Function rpart() is used to build a decision tree, and the tree with the minimum prediction error is selected. After that, it is applied to new data to make prediction with function predict().
```{r}
library(mboost)
data("bodyfat", package = "TH.data")
```

```{r}
dim(bodyfat)
```

```{r}
attributes(bodyfat)
```

```{r}
bodyfat[1:5,]
```
split the data into training and test datasets. 

build a decision tree on the training dataset.


```{r}
set.seed(1234)
ind  <- sample(2,nrow(bodyfat), replace=T, prob=c(0.7, 0.3))
bodyfat.train  <- bodyfat[ind == 1,]
bodyfat.test  <- bodyfat[ind == 2,]
```


train a decision tree. 
```{r}
library(rpart)
myFormula  <- DEXfat ~ age + waistcirc + waistcirc + 
  elbowbreadth + kneebreadth
bodyfat_rpart <- rpart(myFormula, data = bodyfat.train,
                       control = rpart.control(minsplit = 10))
```


```{r}
attributes(bodyfat_rpart)
```


```{r}
print(bodyfat_rpart$cptable)
View(bodyfat_rpart$cptable)
```


```{r}
print(bodyfat_rpart)
```

Plot the tree 

```{r}
plot(bodyfat_rpart)
text(bodyfat_rpart, use.n=T)
```

select the tree with minimum prediction error
```{r}
opt  <- which.min(bodyfat_rpart$cptable[,"xerror"])
cp  <- bodyfat_rpart$cptable[opt, "CP"]
bodyfat_prune  <- prune(bodyfat_rpart, cp = cp)
print(bodyfat_prune)
```



```{r}
plot(bodyfat_prune)
text(bodyfat_prune, use.n = T)
```

use the selected tree to make prediciton and compared with actual labels. 


```{r}
DEXfat_pred  <- predict(bodyfat_prune, newdata= bodyfat.test)
xlim  <- range(bodyfat$DEXfat)
plot(DEXfat_pred ~ DEXfat, data = bodyfat.test, xlab="Observed",
     ylab="Predicted", ylim=xlim, xlim=xlim)
abline(a=0, b=1)
```




